generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id            String             @id @default(uuid())
    name          String
    email         String             @unique
    phoneNumber   String?            @map("phone_number")
    pets          Pet[]
    password      String?
    salt          String?
    roles         Roles[]            @default([CLIENT])
    photo         String?
    oauthAccounts UserOAuthAccount[]
    createdAt     DateTime           @default(now()) @map("created_at")
    updatedAt     DateTime           @updatedAt @map("updated_at")

    vetProfile   VetProfile?
    vetSchedule  VetSchedule?
    appointments Appointment[]

    @@map("users")
}

model UserOAuthAccount {
    userId            String   @map("user_id")
    provider          String
    providerAccountId String   @unique() @map("provider_account_id")
    createdAt         DateTime @default(now()) @map("created_at")
    updatedAt         DateTime @updatedAt @map("updated_at")
    user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    @@id([providerAccountId, provider])
    @@map("user_oauth_accounts")
}

model VetProfile {
    id       String       @id @default(uuid())
    userId   String       @unique @map("user_id")
    user     User         @relation(fields: [userId], references: [id])
    services VetService[] @relation("VetProfileServices")

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    @@map("vet_profiles")
}

model VetSchedule {
    id             String                    @id @default(uuid())
    userId         String                    @unique @map("user_id")
    user           User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
    availabilities VetScheduleAvailability[]
    appointments   Appointment[]

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    @@map("vet_schedules")
}

model VetScheduleAvailability {
    id            String            @id @default(uuid())
    vetScheduleId String            @map("vet_schedule_id")
    vetSchedule   VetSchedule       @relation(fields: [vetScheduleId], references: [id], onDelete: Cascade)
    startTime     String            @map("start_time")
    endTime       String            @map("end_time")
    dayOfWeek     ScheduleDayOfWeek @map("day_of_week")

    @@index([vetScheduleId], name: "vet_schedule_id_index")
    @@map("vet_schedule_availabilities")
}

model Service {
    id                String   @id @default(uuid())
    name              String
    description       String?
    durationInMinutes Int      @map("duration_in_minutes")
    isActive          Boolean  @default(true) @map("is_active")
    createdAt         DateTime @default(now()) @map("created_at")
    updatedAt         DateTime @updatedAt @map("updated_at")

    vetServices  VetService[]  @relation("VetServices")
    appointments Appointment[]

    @@map("services")
}

model VetService {
    id String @id @default(uuid())

    vetId     String     @map("vet_id")
    vet       VetProfile @relation(fields: [vetId], references: [id], name: "VetProfileServices")
    serviceId String     @map("service_id")
    service   Service    @relation(fields: [serviceId], references: [id], name: "VetServices", onDelete: Cascade)

    @@unique([vetId, serviceId])
    @@map("vet_services")
}

model Appointment {
    id     String  @id @default(uuid())
    userId String? @map("user_id")
    user   User?   @relation(fields: [userId], references: [id], onDelete: SetNull)

    petId String? @map("pet_id")
    pet   Pet?    @relation(fields: [petId], references: [id], onDelete: SetNull)

    contactName  String? @map("contact_name")
    contactEmail String? @map("contact_email")
    contactPhone String? @map("contact_phone")

    vetScheduleId String      @map("vet_schedule_id")
    vetSchedule   VetSchedule @relation(fields: [vetScheduleId], references: [id])

    serviceId String  @map("service_id")
    service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

    startTime DateTime @map("start_time")
    endTime   DateTime @map("end_time")

    status    AppointmentStatus @default(PENDING)
    createdAt DateTime          @default(now()) @map("created_at")
    updatedAt DateTime          @updatedAt @map("updated_at")

    @@map("appointments")
}

model Pet {
    id       String    @id @default(uuid())
    name     String
    species  String
    breed    String?
    birthday DateTime?
    photo    String?

    userId String @map("user_id")
    user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

    appointments Appointment[]

    createdAt DateTime @default(now()) @map("created_at")
    updatedAt DateTime @updatedAt @map("updated_at")

    @@map("pets")
}

enum ScheduleDayOfWeek {
    MONDAY
    TUESDAY
    WEDNESDAY
    THURSDAY
    FRIDAY
    SATURDAY
    SUNDAY

    @@map("schedule_day_of_week")
}

enum Roles {
    ADMIN
    VET
    CLIENT

    @@map("roles")
}

enum AppointmentStatus {
    PENDING
    CONFIRMED
    CANCELLED
    COMPLETED

    @@map("appointment_status")
}
